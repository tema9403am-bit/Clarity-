<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clarity Chain ‚Äî Hot Wallet</title>

<!-- Telegram Web App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root{--bg:#000;--muted:#8f98a0;--accent:#00aaff}
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial}
  .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;text-align:center}
  h1{color:var(--accent);font-size:28px;margin:0 0 8px}
  p.sub{color:var(--muted);margin:6px 0 18px}
  .hidden{display:none}
  .btn{display:inline-block;padding:12px 20px;margin:8px;border-radius:10px;background:var(--accent);color:#000;font-weight:600;border:none;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid #333;color:var(--muted)}
  .menu .btn{display:block;width:86%;max-width:360px;margin:10px auto}
  input[type="text"], input[type="number"]{padding:10px;width:86%;max-width:360px;border-radius:8px;border:1px solid #333;background:#111;color:#fff;margin:8px 0}
  .small{font-size:13px;color:#bbb;margin-top:10px}
  .info{color:#ffd54a;font-size:14px;margin-top:8px}
</style>
</head>
<body>
  <div class="wrap">
    <div id="startScreen">
      <h1>Clarity Chain</h1>
      <p class="sub">–ü–æ–≥—Ä—É–∑–∏—Å—å –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–∏</p>
      <button id="startBtn" class="btn">–ù–∞—á–∞—Ç—å</button>
    </div>

    <div id="mainMenu" class="hidden">
      <h1>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h1>
      <div class="menu">
        <button id="whereBtn" class="btn">–ì–¥–µ —è?</button>
        <button id="experimentBtn" class="btn">–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ</button>
        <button id="statsBtn" class="btn">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
      </div>
      <div class="small">–í–µ—Ä—Å–∏—è: pilot ‚Ä¢ –¢–æ–ª—å–∫–æ Hot Wallet</div>
    </div>

    <div id="experimentScreen" class="hidden">
      <h1>–£—á–∞—Å—Ç–≤—É–π –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–µ</h1>
      <button id="connectHotWallet" class="btn">–ü–æ–¥–∫–ª—é—á–∏—Ç—å Hot Wallet</button>
      <div id="walletState" class="small" style="margin-top:10px"></div>
      <div id="infoBox" class="info hidden"></div>
      <div style="margin-top:14px">
        <button id="backToMenu" class="btn ghost">–ù–∞–∑–∞–¥</button>
      </div>
    </div>

    <div id="whereScreen" class="hidden">
      <h1>–ì–¥–µ —è?</h1>
      <p class="sub">–¢—ã –≤ –ø–∏–ª–æ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ Clarity Chain ‚Äî –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –∫—Ä–∞—É–¥—Ñ–∞–Ω–¥–∏–Ω–≥–æ–≤–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ.</p>
      <button id="backFromWhere" class="btn ghost">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="statsScreen" class="hidden">
      <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
      <p class="sub">–î–∞–Ω–Ω—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.</p>
      <button id="backFromStats" class="btn ghost">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="debug" class="small" style="margin-top:18px;color:#666"></div>
  </div>

<script>
(async function(){
  // DOM
  const startScreen = document.getElementById('startScreen');
  const mainMenu = document.getElementById('mainMenu');
  const experimentScreen = document.getElementById('experimentScreen');
  const whereScreen = document.getElementById('whereScreen');
  const statsScreen = document.getElementById('statsScreen');
  const walletState = document.getElementById('walletState');
  const debug = document.getElementById('debug');
  const infoBox = document.getElementById('infoBox');

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è
  document.getElementById('startBtn').onclick = ()=>{ startScreen.classList.add('hidden'); mainMenu.classList.remove('hidden'); };
  document.getElementById('whereBtn').onclick = ()=>{ mainMenu.classList.add('hidden'); whereScreen.classList.remove('hidden'); };
  document.getElementById('backFromWhere').onclick = ()=>{ whereScreen.classList.add('hidden'); mainMenu.classList.remove('hidden'); };
  document.getElementById('statsBtn').onclick = ()=>{ mainMenu.classList.add('hidden'); statsScreen.classList.remove('hidden'); };
  document.getElementById('backFromStats').onclick = ()=>{ statsScreen.classList.add('hidden'); mainMenu.classList.remove('hidden'); };
  document.getElementById('experimentBtn').onclick = ()=>{ mainMenu.classList.add('hidden'); experimentScreen.classList.remove('hidden'); };
  document.getElementById('backToMenu').onclick = ()=>{ experimentScreen.classList.add('hidden'); mainMenu.classList.remove('hidden'); };

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
  // Telegram SDK –¥–æ–±–∞–≤–ª–µ–Ω –≤ <head>, –Ω–æ –µ—â—ë –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é ‚Äî
  // –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.
  function noTg(message){
    walletState.innerHTML = "‚ö†Ô∏è –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±–æ—Ç–∞ –≤ Telegram (Mini App).";
    debug.innerText = "Telegram WebApp API –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω. " + (message || "");
    infoBox.classList.remove('hidden');
    infoBox.textContent = "–û—Ç–∫—Ä–æ–π –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±–æ—Ç–∞ –≤ Telegram (–Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ).";
  }

  // window.Telegram may exist but WebApp might not be ready instantly; guard carefully.
  const tg = window.Telegram;

  if(!tg || !tg.WebApp){
    noTg("window.Telegram –∏–ª–∏ Telegram.WebApp –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç");
    return;
  }

  // –ü–æ–ª—É—á–∏–ª–∏ tg.WebApp
  const WebApp = tg.WebApp;

  try {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ: ready() –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –º–Ω–æ–≥–æ —Ä–∞–∑ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.
    if(typeof WebApp.ready === 'function') WebApp.ready();
    // –ü–æ–ø—Ä–æ–±—É–µ–º —Ä–∞—Å—à–∏—Ä–∏—Ç—å webview (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
    if(typeof WebApp.expand === 'function') {
      try { WebApp.expand(); } catch(e) { /* ignore non-critical */ }
    }

    debug.innerText = "Telegram WebApp API –¥–æ—Å—Ç—É–ø–µ–Ω";
    walletState.innerHTML = "üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Telegram WebApp";

    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ–±–æ–ª—å—à—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É, –µ—Å–ª–∏ initData –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
    if(!WebApp.initData && !WebApp.initDataUnsafe){
      infoBox.classList.remove('hidden');
      infoBox.textContent = "–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –±–æ—Ç–∞ (web_app).";
    } else {
      infoBox.classList.add('hidden');
    }

  } catch(err){
    noTg("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WebApp: " + (err.message||err));
    return;
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Hot Wallet ‚Äî –ø—Ä–∏–Ω—è—Ç—ã–π flow –¥–ª—è Hot Wallet –≤ Telegram:
  // –û–±—ã—á–Ω–æ Hot Wallet –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Web App –º–µ—Ç–æ–¥ 'requestHotWallet' (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
  // –ù–æ Telegram –Ω–µ –∏–º–µ–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ 'requestHotWallet' –≤ –ø—É–±–ª–∏—á–Ω–æ–º SDK.
  // –ü–æ—ç—Ç–æ–º—É –∑–¥–µ—Å—å –¥–µ–ª–∞–µ–º –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
  // 1) –ï—Å–ª–∏ WebApp has "initDataUnsafe.user", –≤–æ–∑—å–º—ë–º telegram id –¥–ª—è backend.
  // 2) –û—Ç–ø—Ä–∞–≤–∏–º –∑–∞–ø—Ä–æ—Å –Ω–∞ backend (placeholder URL). –ï—Å–ª–∏ –±–µ–∫–µ–Ω–¥–∞ –Ω–µ—Ç ‚Äî –∏–º–∏—Ç–∏—Ä—É–µ–º —É—Å–ø–µ—Ö.
  // 3) –í—ã–≤–µ–¥–µ–º –ø–æ–Ω—è—Ç–Ω—ã–π UI —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

  document.getElementById('connectHotWallet').onclick = async () => {
    walletState.innerHTML = "‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Hot Wallet...";
    // –ó–∞–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ Telegram (–±–µ–∑–æ–ø–∞—Å–Ω–æ —á–µ—Ä–µ–∑ initDataUnsafe)
    const user = WebApp.initDataUnsafe && WebApp.initDataUnsafe.user ? WebApp.initDataUnsafe.user : null;

    if(!user){
      // –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å initData —á–µ—Ä–µ–∑ WebApp.initData (–ø–æ–¥–ø–∏—Å—å) ‚Äî —á–∞—â–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ –Ω–∞ backend.
      if(WebApp.initData){
        // initData –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –Ω–æ —Ä–∞–∑–±–æ—Ä –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ initData —Ç—Ä–µ–±—É–µ—Ç backend-–≤–∞–ª–∏–¥–∞—Ü–∏–∏.
        // –ú—ã —Å–æ–æ–±—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –ø—Ä–µ–¥–ª–æ–∂–∏–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –±–µ–∫–µ–Ω–¥.
        walletState.innerHTML = "‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç—Å—è –±–µ–∫–µ–Ω–¥ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ initData).";
        debug.innerText = "initData –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø–æ–¥–ø–∏—Å—å –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (–Ω–∞ –±–µ–∫–µ–Ω–¥–µ).";
      } else {
        walletState.innerHTML = "üö´ –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ Telegram (user –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç).";
        return;
      }
    }

    // –§–æ—Ä–º–∏—Ä—É–µ–º payload –¥–ª—è –±–µ–∫–µ–Ω–¥–∞
    const payload = {
      telegram_id: user ? user.id : null,
      username: user ? user.username : null,
      first_name: user ? user.first_name : null,
      // –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ initData ‚Äî –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ—ë –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –±–µ–∫–µ–Ω–¥ (–µ—Å–ª–∏ –µ—Å—Ç—å)
      initData: WebApp.initData || null
    };

    // –ó–¥–µ—Å—å —É–∫–∞–∂–∏ —Ä–µ–∞–ª—å–Ω—ã–π URL —Å–≤–æ–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É Hot Wallet (placeholder —Å–µ–π—á–∞—Å)
    const BACKEND_URL = "https://your-backend.example.com/api/connect-hotwallet"; // –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–π

    // –ï—Å–ª–∏ –±–µ–∫–µ–Ω–¥ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Äî –∏–º–∏—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é "—É—Å–ø–µ—à–Ω—É—é" –ø—Ä–∏–≤—è–∑–∫—É (–¥–ª—è —Ç–µ—Å—Ç–∞ UI).
    if(!BACKEND_URL || BACKEND_URL.includes("your-backend")){
      // —Å–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É
      await new Promise(r => setTimeout(r, 800));
      walletState.innerHTML = `‚úÖ Hot Wallet (—Å–∏–º—É–ª—è—Ü–∏—è) –ø—Ä–∏–≤—è–∑–∞–Ω –¥–ª—è ${user ? ("@" + (user.username || user.id)) : "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"}`;
      debug.innerText = "Backend –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ó–∞–º–µ–Ω–∏—Ç–µ BACKEND_URL –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL.";
      return;
    }

    // –ï—Å–ª–∏ –±–µ–∫–µ–Ω–¥ —É–∫–∞–∑–∞–Ω ‚Äî –ø—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
    try {
      const res = await fetch(BACKEND_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      if(!res.ok){
        const txt = await res.text();
        walletState.innerHTML = "‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ Hot Wallet.";
        debug.innerText = `Backend error: ${res.status} ${txt}`;
        return;
      }
      const json = await res.json();
      if(json && json.success){
        walletState.innerHTML = `‚úÖ Hot Wallet –ø—Ä–∏–≤—è–∑–∞–Ω: ${json.account || (user ? ("@" + (user.username || user.id)) : "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å")}`;
        debug.innerText = "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ (–ø–æ –æ—Ç–≤–µ—Ç—É –±–µ–∫–µ–Ω–¥–∞).";
      } else {
        walletState.innerHTML = "‚ùå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å (–±–µ–∫–µ–Ω–¥ –æ—Ç–≤–µ—Ç–∏–ª –æ—à–∏–±–∫–æ–π).";
        debug.innerText = "Response: " + JSON.stringify(json);
      }
    } catch(err){
      walletState.innerHTML = "‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ Hot Wallet.";
      debug.innerText = "Fetch error: " + (err.message||err);
    }
  };

})();
</script>
</body>
</html>